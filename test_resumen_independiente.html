<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test ResumenVentas Independiente</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }

        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .data-display {
            background: #e9ecef;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üß™ Test ResumenVentas - Datos Independientes por ID</h1>

        <div class="test-section">
            <h3>üìã Instrucciones</h3>
            <p>Este test verifica que cada ID (ID1, ID2, etc.) tenga datos de ResumenVentas independientes.</p>
            <ol>
                <li>Ejecuta "Simular Datos Diferentes"</li>
                <li>Ve a la aplicaci√≥n en <a href="http://localhost:3000/cargue/MARTES"
                        target="_blank">localhost:3000/cargue/MARTES</a></li>
                <li>Cambia entre ID1 e ID2</li>
                <li>Verifica que los conceptos sean diferentes</li>
                <li>Revisa la consola del navegador para ver los logs</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>üéõÔ∏è Controles de Test</h3>
            <button onclick="simularDatos()">Simular Datos Diferentes</button>
            <button onclick="verificarDatos()">Verificar Datos Guardados</button>
            <button onclick="limpiarDatos()">Limpiar Datos</button>
            <button onclick="mostrarClaves()">Mostrar Claves localStorage</button>
        </div>

        <div class="test-section">
            <h3>üìä Resultados</h3>
            <div id="resultados"></div>
        </div>

        <div class="test-section">
            <h3>üìù Logs</h3>
            <div id="logs" class="log"></div>
        </div>
    </div>

    <script>
        let logContainer = document.getElementById('logs');
        let resultadosContainer = document.getElementById('resultados');

        function log(mensaje) {
            console.log(mensaje);
            logContainer.innerHTML += mensaje + '\n';
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function mostrarResultado(html) {
            resultadosContainer.innerHTML = html;
        }

        function simularDatos() {
            log('üß™ SIMULANDO datos diferentes para cada ID...');

            const fecha = '2025-09-23';
            const dia = 'MARTES';

            // Datos para ID1
            const datosID1 = {
                conceptos: [
                    { concepto: 'VENTA DIRECTA ID1', descuentos: 5000, nequi: 10000, daviplata: 2000 },
                    { concepto: 'PROMOCION ID1', descuentos: 1000, nequi: 0, daviplata: 3000 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 }
                ],
                baseCaja: 50000
            };

            // Datos para ID2
            const datosID2 = {
                conceptos: [
                    { concepto: 'VENTA MAYORISTA ID2', descuentos: 8000, nequi: 15000, daviplata: 5000 },
                    { concepto: 'DESCUENTO ESPECIAL ID2', descuentos: 2000, nequi: 0, daviplata: 1000 },
                    { concepto: 'BONIFICACION ID2', descuentos: 0, nequi: 5000, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 },
                    { concepto: '', descuentos: 0, nequi: 0, daviplata: 0 }
                ],
                baseCaja: 75000
            };

            // Guardar con las nuevas claves espec√≠ficas por ID
            const keyConceptosID1 = `conceptos_pagos_${dia}_ID1_${fecha}`;
            const keyBaseCajaID1 = `base_caja_${dia}_ID1_${fecha}`;
            const keyConceptosID2 = `conceptos_pagos_${dia}_ID2_${fecha}`;
            const keyBaseCajaID2 = `base_caja_${dia}_ID2_${fecha}`;

            localStorage.setItem(keyConceptosID1, JSON.stringify(datosID1.conceptos));
            localStorage.setItem(keyBaseCajaID1, datosID1.baseCaja.toString());
            localStorage.setItem(keyConceptosID2, JSON.stringify(datosID2.conceptos));
            localStorage.setItem(keyBaseCajaID2, datosID2.baseCaja.toString());

            log('‚úÖ Datos simulados guardados:');
            log(`üìã ID1 - Clave conceptos: ${keyConceptosID1}`);
            log(`üí∞ ID1 - Clave base caja: ${keyBaseCajaID1} = ${datosID1.baseCaja}`);
            log(`üìã ID2 - Clave conceptos: ${keyConceptosID2}`);
            log(`üí∞ ID2 - Clave base caja: ${keyBaseCajaID2} = ${datosID2.baseCaja}`);

            mostrarResultado(`
                <div class="success">
                    <h4>‚úÖ Datos Simulados Correctamente</h4>
                    <div class="data-display">
                        <strong>ID1:</strong><br>
                        - Conceptos: ${datosID1.conceptos.filter(c => c.concepto).length}<br>
                        - Base Caja: $${datosID1.baseCaja.toLocaleString()}<br>
                        - Conceptos: ${datosID1.conceptos.filter(c => c.concepto).map(c => c.concepto).join(', ')}
                    </div>
                    <div class="data-display">
                        <strong>ID2:</strong><br>
                        - Conceptos: ${datosID2.conceptos.filter(c => c.concepto).length}<br>
                        - Base Caja: $${datosID2.baseCaja.toLocaleString()}<br>
                        - Conceptos: ${datosID2.conceptos.filter(c => c.concepto).map(c => c.concepto).join(', ')}
                    </div>
                </div>
            `);
        }

        function verificarDatos() {
            log('üîç VERIFICANDO datos guardados...');

            const fecha = '2025-09-23';
            const dia = 'MARTES';

            const keyConceptosID1 = `conceptos_pagos_${dia}_ID1_${fecha}`;
            const keyBaseCajaID1 = `base_caja_${dia}_ID1_${fecha}`;
            const keyConceptosID2 = `conceptos_pagos_${dia}_ID2_${fecha}`;
            const keyBaseCajaID2 = `base_caja_${dia}_ID2_${fecha}`;

            const conceptosID1 = localStorage.getItem(keyConceptosID1);
            const baseCajaID1 = localStorage.getItem(keyBaseCajaID1);
            const conceptosID2 = localStorage.getItem(keyConceptosID2);
            const baseCajaID2 = localStorage.getItem(keyBaseCajaID2);

            log(`üìÇ ID1 conceptos: ${conceptosID1 ? 'S√ç' : 'NO'}`);
            log(`üí∞ ID1 base caja: ${baseCajaID1 || 'NO'}`);
            log(`üìÇ ID2 conceptos: ${conceptosID2 ? 'S√ç' : 'NO'}`);
            log(`üí∞ ID2 base caja: ${baseCajaID2 || 'NO'}`);

            let html = '<div class="';

            if (conceptosID1 && conceptosID2 && baseCajaID1 && baseCajaID2) {
                html += 'success"><h4>‚úÖ Todos los Datos Encontrados</h4>';

                if (conceptosID1) {
                    const parsedID1 = JSON.parse(conceptosID1);
                    const conceptosValidosID1 = parsedID1.filter(c => c.concepto);
                    html += `<div class="data-display"><strong>ID1:</strong> ${conceptosValidosID1.length} conceptos, Base: $${parseInt(baseCajaID1).toLocaleString()}</div>`;
                }

                if (conceptosID2) {
                    const parsedID2 = JSON.parse(conceptosID2);
                    const conceptosValidosID2 = parsedID2.filter(c => c.concepto);
                    html += `<div class="data-display"><strong>ID2:</strong> ${conceptosValidosID2.length} conceptos, Base: $${parseInt(baseCajaID2).toLocaleString()}</div>`;
                }
            } else {
                html += 'warning"><h4>‚ö†Ô∏è Datos Incompletos</h4>';
                html += '<p>Algunos datos no se encontraron. Ejecuta "Simular Datos Diferentes" primero.</p>';
            }

            html += '</div>';
            mostrarResultado(html);
        }

        function limpiarDatos() {
            log('üßπ LIMPIANDO datos de prueba...');

            const fecha = '2025-09-23';
            const dia = 'MARTES';

            const claves = [
                `conceptos_pagos_${dia}_ID1_${fecha}`,
                `base_caja_${dia}_ID1_${fecha}`,
                `conceptos_pagos_${dia}_ID2_${fecha}`,
                `base_caja_${dia}_ID2_${fecha}`
            ];

            claves.forEach(clave => {
                localStorage.removeItem(clave);
                log(`üóëÔ∏è Eliminado: ${clave}`);
            });

            mostrarResultado('<div class="success"><h4>‚úÖ Datos Limpiados</h4><p>Todos los datos de prueba han sido eliminados.</p></div>');
        }

        function mostrarClaves() {
            log('üîç MOSTRANDO todas las claves de localStorage...');

            const todasLasClaves = Object.keys(localStorage);
            const clavesRelevantes = todasLasClaves.filter(clave =>
                clave.includes('conceptos_pagos') || clave.includes('base_caja')
            );

            log(`üìä Total claves: ${todasLasClaves.length}`);
            log(`üìã Claves relevantes: ${clavesRelevantes.length}`);

            if (clavesRelevantes.length > 0) {
                log('üìã Claves de ResumenVentas encontradas:');
                clavesRelevantes.forEach(clave => {
                    const valor = localStorage.getItem(clave);
                    if (clave.includes('conceptos_pagos')) {
                        try {
                            const conceptos = JSON.parse(valor);
                            const conceptosValidos = conceptos.filter(c => c.concepto);
                            log(`   ${clave}: ${conceptosValidos.length} conceptos`);
                        } catch (e) {
                            log(`   ${clave}: Error parsing`);
                        }
                    } else {
                        log(`   ${clave}: ${valor}`);
                    }
                });
            } else {
                log('‚ùå No se encontraron claves de ResumenVentas');
            }

            let html = `<div class="data-display">
                <strong>Claves Totales:</strong> ${todasLasClaves.length}<br>
                <strong>Claves ResumenVentas:</strong> ${clavesRelevantes.length}
            </div>`;

            if (clavesRelevantes.length > 0) {
                html += '<div class="data-display"><strong>Claves Encontradas:</strong><br>';
                clavesRelevantes.forEach(clave => {
                    html += `- ${clave}<br>`;
                });
                html += '</div>';
            }

            mostrarResultado(html);
        }

        // Limpiar logs al cargar
        log('üß™ Test ResumenVentas Independiente cargado');
        log('üìã Usa los botones para probar la funcionalidad');
    </script>
</body>

</html>