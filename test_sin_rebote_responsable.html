<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Sin Rebote Responsable</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }

        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .demo {
            padding: 15px;
            border: 2px solid #FF3333;
            border-radius: 8px;
            background: #fff8f8;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üö´ Test Sin Rebote Responsable</h1>

        <div class="test-section">
            <h3>üéØ Problema del Rebote</h3>
            <p><strong>Antes:</strong> Al recargar la p√°gina aparec√≠a primero un nombre (ej: "WILSON") y despu√©s el
                correcto (ej: "CARLOS")</p>
            <p><strong>Soluci√≥n:</strong> Cargar directamente desde la base de datos sin usar localStorage como inicial
            </p>
        </div>

        <div class="test-section">
            <h3>‚úÖ Soluci√≥n Implementada</h3>
            <div class="demo">
                <strong>VENDEDOR:</strong> <span style="color: #FF3333; font-weight: bold; font-size: 1.2rem;">CARLOS
                    RODRIGUEZ</span> ‚úèÔ∏è
                <div style="margin-top: 5px; color: #6c757d; font-size: 0.875rem;">
                    MARTES - 2025-09-23 - ID1
                </div>
            </div>
            <p><em>üëÜ As√≠ debe aparecer inmediatamente sin rebote</em></p>
        </div>

        <div class="test-section">
            <h3>üß™ C√≥mo Probar</h3>
            <button onclick="simularDatos()">Simular Datos de Prueba</button>
            <button onclick="abrirApp()">Abrir Aplicaci√≥n</button>
            <button onclick="limpiarDatos()">Limpiar Datos</button>

            <div id="resultados" class="mt-3"></div>
        </div>

        <div class="test-section">
            <h3>üìã Pasos de Verificaci√≥n</h3>
            <ol>
                <li><strong>Configurar datos:</strong> Hacer clic en "Simular Datos de Prueba"</li>
                <li><strong>Ir a la app:</strong> <a href="http://localhost:3000/cargue/MARTES"
                        target="_blank">localhost:3000/cargue/MARTES</a></li>
                <li><strong>Seleccionar ID1:</strong> Verificar que aparece "CARLOS RODRIGUEZ"</li>
                <li><strong>Recargar p√°gina:</strong> Presionar F5 o Ctrl+R</li>
                <li><strong>Observar:</strong> Debe aparecer "CARLOS RODRIGUEZ" inmediatamente SIN mostrar otro nombre
                    antes</li>
                <li><strong>Cambiar a ID2:</strong> Debe aparecer "MARIA GONZALEZ" inmediatamente</li>
                <li><strong>Volver a ID1:</strong> Debe aparecer "CARLOS RODRIGUEZ" sin rebote</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>üîç Logs Esperados (Consola)</h3>
            <div class="log">
                üîç CARGA DIRECTA - Cargando responsable para ID1 desde BD...
                ‚úÖ CARGA DIRECTA - Responsable encontrado: "CARLOS RODRIGUEZ"
                üéØ CAMBIO EN nombreResponsable para ID1: "CARLOS RODRIGUEZ"
            </div>
            <p><strong>‚ùå NO debe aparecer:</strong></p>
            <div class="log" style="background: #f8d7da;">
                üì¶ INICIAL - Responsable desde localStorage para ID1: "WILSON"
                ‚ö° CARGA INMEDIATA - Encontrado en BD: "CARLOS RODRIGUEZ"
            </div>
        </div>

        <div class="test-section warning">
            <h3>‚ö†Ô∏è Indicadores de Rebote</h3>
            <ul>
                <li><strong>Rebote visual:</strong> Aparece un nombre y despu√©s cambia a otro</li>
                <li><strong>Logs duplicados:</strong> M√∫ltiples cambios de nombreResponsable</li>
                <li><strong>Parpadeo:</strong> El campo "parpadea" al cargar</li>
                <li><strong>Delay:</strong> Demora en mostrar el nombre correcto</li>
            </ul>
        </div>

        <div class="test-section success">
            <h3>‚úÖ Indicadores Sin Rebote</h3>
            <ul>
                <li><strong>Carga directa:</strong> Aparece el nombre correcto inmediatamente</li>
                <li><strong>Un solo log:</strong> Solo un cambio de nombreResponsable</li>
                <li><strong>Sin parpadeo:</strong> El campo se mantiene estable</li>
                <li><strong>Instant√°neo:</strong> No hay delay visible</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üìù Logs</h3>
            <div id="logs" class="log"></div>
        </div>
    </div>

    <script>
        let logContainer = document.getElementById('logs');
        let resultadosContainer = document.getElementById('resultados');

        function log(mensaje) {
            console.log(mensaje);
            logContainer.innerHTML += mensaje + '\n';
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function mostrarResultado(html) {
            resultadosContainer.innerHTML = html;
        }

        function simularDatos() {
            log('üß™ SIMULANDO datos de responsables para prueba de rebote...');

            // Datos diferentes para localStorage y BD (para simular el problema)
            const responsablesLS = {
                ID1: 'WILSON MARTINEZ',  // Dato "viejo" en localStorage
                ID2: 'PEDRO SANCHEZ',    // Dato "viejo" en localStorage
                ID3: 'LUIS TORRES'       // Dato "viejo" en localStorage
            };

            const responsablesBD = {
                ID1: 'CARLOS RODRIGUEZ', // Dato "correcto" en BD
                ID2: 'MARIA GONZALEZ',   // Dato "correcto" en BD
                ID3: 'ANA MARTINEZ'      // Dato "correcto" en BD
            };

            // Simular localStorage con datos "viejos"
            localStorage.setItem('responsables_cargue', JSON.stringify(responsablesLS));
            Object.entries(responsablesLS).forEach(([id, nombre]) => {
                localStorage.setItem(`responsable_${id}`, nombre);
                localStorage.setItem(`cargue_responsable_${id}`, nombre);
            });

            log('üì¶ Datos "viejos" guardados en localStorage:');
            Object.entries(responsablesLS).forEach(([id, nombre]) => {
                log(`   ${id}: ${nombre}`);
            });

            log('üéØ Datos "correctos" que deber√≠an venir de BD:');
            Object.entries(responsablesBD).forEach(([id, nombre]) => {
                log(`   ${id}: ${nombre}`);
            });

            mostrarResultado(`
                <div class="success">
                    <h4>‚úÖ Datos de Prueba Configurados</h4>
                    <p><strong>Escenario:</strong> localStorage tiene datos "viejos", BD tiene datos "correctos"</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 10px 0;">
                        <div>
                            <strong>localStorage (viejo):</strong><br>
                            ID1: WILSON MARTINEZ<br>
                            ID2: PEDRO SANCHEZ<br>
                            ID3: LUIS TORRES
                        </div>
                        <div>
                            <strong>BD (correcto):</strong><br>
                            ID1: CARLOS RODRIGUEZ<br>
                            ID2: MARIA GONZALEZ<br>
                            ID3: ANA MARTINEZ
                        </div>
                    </div>
                    <p><strong>‚úÖ Sin rebote:</strong> Debe aparecer directamente el nombre de BD</p>
                    <p><strong>‚ùå Con rebote:</strong> Aparecer√≠a primero localStorage, despu√©s BD</p>
                </div>
            `);
        }

        function abrirApp() {
            window.open('http://localhost:3000/cargue/MARTES', '_blank');
            log('üåê Abriendo aplicaci√≥n en nueva pesta√±a...');

            mostrarResultado(`
                <div class="warning">
                    <h4>üîç Verificaci√≥n Manual</h4>
                    <p>La aplicaci√≥n se abri√≥ en una nueva pesta√±a. Sigue estos pasos:</p>
                    <ol>
                        <li>Selecciona ID1 y observa el nombre que aparece</li>
                        <li>Recarga la p√°gina (F5) y observa si hay rebote</li>
                        <li>Cambia entre ID1, ID2, ID3 y observa los cambios</li>
                        <li>Revisa la consola del navegador para ver los logs</li>
                    </ol>
                </div>
            `);
        }

        function limpiarDatos() {
            log('üßπ LIMPIANDO datos de prueba...');

            const claves = [
                'responsables_cargue',
                'responsable_ID1', 'responsable_ID2', 'responsable_ID3',
                'responsable_ID4', 'responsable_ID5', 'responsable_ID6',
                'cargue_responsable_ID1', 'cargue_responsable_ID2', 'cargue_responsable_ID3',
                'cargue_responsable_ID4', 'cargue_responsable_ID5', 'cargue_responsable_ID6'
            ];

            claves.forEach(clave => {
                if (localStorage.getItem(clave)) {
                    localStorage.removeItem(clave);
                    log(`üóëÔ∏è Eliminado: ${clave}`);
                }
            });

            mostrarResultado(`
                <div class="success">
                    <h4>‚úÖ Datos Limpiados</h4>
                    <p>Todos los datos de localStorage han sido eliminados. Los campos mostrar√°n "RESPONSABLE" por defecto o cargar√°n desde BD.</p>
                </div>
            `);
        }

        // Inicializar
        log('üö´ Test Sin Rebote Responsable cargado');
        log('üìã Configura datos de prueba y verifica en la aplicaci√≥n');
    </script>
</body>

</html>