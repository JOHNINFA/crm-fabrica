<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Sin Rebote Final</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }

        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        button {
            padding: 10px 15px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .demo {
            padding: 15px;
            border: 2px solid #FF3333;
            border-radius: 8px;
            background: #fff8f8;
            margin: 10px 0;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }

        .comparison>div {
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üö´ Test Sin Rebote Final - Soluci√≥n Definitiva</h1>

        <div class="test-section">
            <h3>üéØ Nueva Estrategia</h3>
            <p><strong>Problema anterior:</strong> "RESPONSABLE" ‚Üí "CARLOS" (segu√≠a siendo rebote)</p>
            <p><strong>Soluci√≥n final:</strong> Cargar inmediatamente desde localStorage, sincronizar silenciosamente
                con BD</p>

            <div class="comparison">
                <div style="background: #f8d7da;">
                    <strong>‚ùå Antes (con rebote):</strong><br>
                    1. Aparece "RESPONSABLE"<br>
                    2. Cambia a "CARLOS"<br>
                    3. Usuario ve el cambio
                </div>
                <div style="background: #d4edda;">
                    <strong>‚úÖ Ahora (sin rebote):</strong><br>
                    1. Aparece "CARLOS" inmediatamente<br>
                    2. BD sincroniza en background<br>
                    3. Usuario no ve cambios
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>üîß C√≥mo Funciona la Soluci√≥n</h3>
            <ol>
                <li><strong>Inicializaci√≥n:</strong> Carga inmediatamente desde localStorage</li>
                <li><strong>Mostrar:</strong> Usuario ve el nombre correcto desde el inicio</li>
                <li><strong>Sincronizaci√≥n:</strong> BD se consulta en background con delay</li>
                <li><strong>Actualizaci√≥n:</strong> Solo si BD tiene un nombre diferente</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>üß™ Configurar Prueba</h3>
            <button onclick="configurarPrueba()">Configurar Datos de Prueba</button>
            <button onclick="abrirApp()">Abrir Aplicaci√≥n</button>
            <button onclick="limpiarTodo()">Limpiar Todo</button>

            <div id="resultados" class="mt-3"></div>
        </div>

        <div class="test-section">
            <h3>üìã Pasos de Verificaci√≥n</h3>
            <ol>
                <li><strong>Configurar:</strong> Hacer clic en "Configurar Datos de Prueba"</li>
                <li><strong>Abrir app:</strong> <a href="http://localhost:3000/cargue/MARTES"
                        target="_blank">localhost:3000/cargue/MARTES</a></li>
                <li><strong>Observar ID1:</strong> Debe aparecer "CARLOS RODRIGUEZ" inmediatamente</li>
                <li><strong>Recargar (F5):</strong> Debe seguir apareciendo "CARLOS RODRIGUEZ" sin cambios</li>
                <li><strong>Cambiar a ID2:</strong> Debe aparecer "MARIA GONZALEZ" inmediatamente</li>
                <li><strong>Volver a ID1:</strong> Debe aparecer "CARLOS RODRIGUEZ" sin delay</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>üîç Logs Esperados (Consola)</h3>
            <div class="log">
                ‚ö° INIT - Carga inmediata desde localStorage: "CARLOS RODRIGUEZ"
                üéØ CAMBIO EN nombreResponsable para ID1: "CARLOS RODRIGUEZ"
                üîÑ SYNC - Sincronizando ID1 con BD (actual: "CARLOS RODRIGUEZ")...
                ‚úÖ SYNC - BD y estado coinciden: "CARLOS RODRIGUEZ" - SIN CAMBIOS
            </div>

            <p><strong>‚ùå NO debe aparecer:</strong></p>
            <div class="log" style="background: #f8d7da;">
                üéØ CAMBIO EN nombreResponsable para ID1: "RESPONSABLE"
                üéØ CAMBIO EN nombreResponsable para ID1: "CARLOS RODRIGUEZ"
            </div>
        </div>

        <div class="test-section success">
            <h3>‚úÖ Indicadores de √âxito</h3>
            <ul>
                <li><strong>Carga instant√°nea:</strong> Nombre correcto aparece inmediatamente</li>
                <li><strong>Un solo log de cambio:</strong> Solo un "CAMBIO EN nombreResponsable"</li>
                <li><strong>Sin parpadeo:</strong> Campo estable desde el inicio</li>
                <li><strong>Cambios r√°pidos:</strong> Entre IDs sin delay</li>
                <li><strong>Recargas suaves:</strong> F5 no causa rebote</li>
            </ul>
        </div>

        <div class="test-section error">
            <h3>‚ùå Indicadores de Fallo</h3>
            <ul>
                <li><strong>Rebote visual:</strong> Cualquier cambio visible despu√©s de cargar</li>
                <li><strong>M√∫ltiples logs:</strong> Varios "CAMBIO EN nombreResponsable"</li>
                <li><strong>Delay:</strong> Demora en mostrar el nombre</li>
                <li><strong>Parpadeo:</strong> Campo cambia despu√©s de aparecer</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üìù Logs de Prueba</h3>
            <div id="logs" class="log"></div>
        </div>
    </div>

    <script>
        let logContainer = document.getElementById('logs');
        let resultadosContainer = document.getElementById('resultados');

        function log(mensaje) {
            console.log(mensaje);
            logContainer.innerHTML += mensaje + '\n';
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function mostrarResultado(html) {
            resultadosContainer.innerHTML = html;
        }

        function configurarPrueba() {
            log('üß™ CONFIGURANDO datos de prueba para eliminar rebote...');

            // Datos que deben aparecer inmediatamente (localStorage)
            const responsablesInmediatos = {
                ID1: 'CARLOS RODRIGUEZ',
                ID2: 'MARIA GONZALEZ',
                ID3: 'ANA MARTINEZ',
                ID4: 'LUIS PEREZ',
                ID5: 'SOFIA LOPEZ',
                ID6: 'DIEGO TORRES'
            };

            // Guardar en localStorage para carga inmediata
            localStorage.setItem('responsables_cargue', JSON.stringify(responsablesInmediatos));

            Object.entries(responsablesInmediatos).forEach(([id, nombre]) => {
                localStorage.setItem(`responsable_${id}`, nombre);
                localStorage.setItem(`cargue_responsable_${id}`, nombre);
                log(`üíæ ${id}: ${nombre} (localStorage)`);
            });

            log('‚úÖ Configuraci√≥n completada');
            log('üìã Ahora los nombres deben aparecer inmediatamente sin rebote');

            mostrarResultado(`
                <div class="success">
                    <h4>‚úÖ Datos Configurados para Prueba Sin Rebote</h4>
                    <p><strong>Estrategia:</strong> Nombres guardados en localStorage para carga inmediata</p>
                    <div style="background: #e9ecef; padding: 10px; border-radius: 5px; margin: 10px 0;">
                        <strong>Responsables configurados:</strong><br>
                        ID1: CARLOS RODRIGUEZ<br>
                        ID2: MARIA GONZALEZ<br>
                        ID3: ANA MARTINEZ<br>
                        ID4: LUIS PEREZ<br>
                        ID5: SOFIA LOPEZ<br>
                        ID6: DIEGO TORRES
                    </div>
                    <p><strong>‚úÖ Resultado esperado:</strong> Nombres aparecen inmediatamente sin rebote</p>
                </div>
            `);
        }

        function abrirApp() {
            window.open('http://localhost:3000/cargue/MARTES', '_blank');
            log('üåê Abriendo aplicaci√≥n para verificar sin rebote...');

            mostrarResultado(`
                <div class="warning">
                    <h4>üîç Verificaci√≥n en Curso</h4>
                    <p>La aplicaci√≥n se abri√≥ en una nueva pesta√±a. Verifica:</p>
                    <ol>
                        <li><strong>Carga inicial:</strong> Nombres aparecen inmediatamente</li>
                        <li><strong>Recargar p√°gina:</strong> Sin rebote al presionar F5</li>
                        <li><strong>Cambiar IDs:</strong> Transiciones instant√°neas</li>
                        <li><strong>Consola:</strong> Solo un log de cambio por ID</li>
                    </ol>
                    <p><strong>üéØ Objetivo:</strong> Cero rebote visual</p>
                </div>
            `);
        }

        function limpiarTodo() {
            log('üßπ LIMPIANDO todos los datos de responsables...');

            const claves = [
                'responsables_cargue',
                'responsable_ID1', 'responsable_ID2', 'responsable_ID3',
                'responsable_ID4', 'responsable_ID5', 'responsable_ID6',
                'cargue_responsable_ID1', 'cargue_responsable_ID2', 'cargue_responsable_ID3',
                'cargue_responsable_ID4', 'cargue_responsable_ID5', 'cargue_responsable_ID6'
            ];

            let eliminados = 0;
            claves.forEach(clave => {
                if (localStorage.getItem(clave)) {
                    localStorage.removeItem(clave);
                    eliminados++;
                    log(`üóëÔ∏è Eliminado: ${clave}`);
                }
            });

            mostrarResultado(`
                <div class="success">
                    <h4>‚úÖ Limpieza Completada</h4>
                    <p>Se eliminaron ${eliminados} claves de localStorage.</p>
                    <p>Los campos mostrar√°n "RESPONSABLE" por defecto o cargar√°n desde BD.</p>
                </div>
            `);
        }

        // Inicializar
        log('üö´ Test Sin Rebote Final cargado');
        log('üìã Configura datos y verifica que no hay rebote visual');
    </script>
</body>

</html>